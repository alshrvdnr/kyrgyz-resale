<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>Gifts KG</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <link rel="stylesheet" href="style.css" />
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
  </head>
  <body>
    <div id="app">
      <!-- ГЛАВНАЯ -->
      <section id="page-home" class="page">
        <header class="main-header">
          <div class="top-location-bar" onclick="toggleCitySelector()">
            <i
              class="fa-solid fa-location-dot"
              style="color: var(--yellow-main)"
            ></i>
            <span id="current-city-label">Бишкек</span>
            <i
              class="fa-solid fa-chevron-right"
              style="font-size: 10px; margin-left: 4px"
            ></i>
          </div>
          <!-- ХЕДЕР С ПОИСКОМ И ПРОФИЛЕМ -->
          <div class="search-profile-row">
            <div class="search-wrapper">
              <i class="fa fa-search" style="color: var(--gray)"></i>
              <input
                type="text"
                id="main-search"
                placeholder="Поиск подарков..."
              />
            </div>
            <div
              id="u-avatar-top"
              class="u-avatar-top-circle"
              onclick="showPage('profile')"
            >
              ?
            </div>
          </div>
          <div class="categories-container">
            <div class="cat-card active" onclick="filterByCat('Все', this)">
              <i class="fa-solid fa-border-all"></i><span>Все</span>
            </div>
            <div class="cat-card" onclick="filterByCat('flowers', this)">
              <i class="fa-solid fa-leaf"></i><span>Цветы</span>
            </div>
            <div class="cat-card" onclick="filterByCat('gifts', this)">
              <i class="fa-solid fa-gift"></i><span>Подарки</span>
            </div>
            <div class="cat-card" onclick="filterByCat('jewelry', this)">
              <i class="fa-solid fa-ring"></i><span>Ювелирка</span>
            </div>
            <div class="cat-card" onclick="filterByCat('certs', this)">
              <i class="fa-solid fa-ticket"></i><span>Сертификаты</span>
            </div>
          </div>
        </header>
        <h2
          id="dynamic-feed-title"
          style="margin: 5px 15px 10px; font-size: 18px"
        >
          Свежие предложения
        </h2>
        <main class="listings-grid" id="home-grid"></main>
      </section>

      <!-- ВЫБОР ГОРОДА -->
      <div id="city-selector" class="hidden modal-overlay">
        <div class="modal-box">
          <i
            class="fa fa-times"
            onclick="toggleCitySelector()"
            style="
              position: absolute;
              top: 15px;
              right: 15px;
              color: var(--yellow-main);
              font-size: 22px;
            "
          ></i>
          <h3 style="margin-top: 0">Выберите город</h3>
          <div
            style="
              display: grid;
              grid-template-columns: 1fr 1fr;
              gap: 10px;
              margin-top: 20px;
            "
          >
            <div class="modal-action-btn" onclick="selectCity('Бишкек')">
              Бишкек
            </div>
            <div class="modal-action-btn" onclick="selectCity('Ош')">Ош</div>
            <div class="modal-action-btn" onclick="selectCity('Манас')">
              Манас
            </div>
            <div class="modal-action-btn" onclick="selectCity('Токмок')">
              Токмок
            </div>
            <div class="modal-action-btn" onclick="selectCity('Каракол')">
              Каракол
            </div>
          </div>
        </div>
      </div>

      <!-- УПРАВЛЕНИЕ -->
      <div id="manage-modal" class="hidden modal-overlay">
        <div class="modal-box">
          <i
            class="fa fa-times"
            onclick="closeManageModal()"
            style="
              position: absolute;
              top: 15px;
              right: 15px;
              color: var(--yellow-main);
              font-size: 22px;
            "
          ></i>
          <h3>Управление</h3>
          <div id="manage-info" class="modal-info-text"></div>
          <div class="modal-btn-list">
            <div class="modal-action-btn edit" onclick="startAdEdit()">
              Изменить
            </div>
            <div class="modal-action-btn sold" onclick="confirmAction('sold')">
              Продано
            </div>
            <div class="modal-action-btn" onclick="confirmAction('delete')">
              Удалить
            </div>
          </div>
        </div>
      </div>

      <!-- ПОДТВЕРЖДЕНИЕ -->
      <div id="confirm-modal" class="hidden modal-overlay">
        <div class="modal-box">
          <h3 id="confirm-title">Вы точно уверены?</h3>
          <p
            id="confirm-text"
            style="font-size: 14px; color: #aaa; margin-bottom: 20px"
          ></p>
          <div style="display: flex; gap: 10px">
            <div
              class="modal-action-btn"
              style="flex: 1; background: #444"
              onclick="closeConfirmModal()"
            >
              Назад
            </div>
            <div
              id="confirm-btn-final"
              class="modal-action-btn"
              style="flex: 1; background: var(--yellow-main); color: #000"
            >
              Да
            </div>
          </div>
        </div>
      </div>

      <!-- ПОДАТЬ ОБЪЯВЛЕНИЕ -->
      <section id="page-add" class="page hidden">
        <header
          style="
            padding: 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
          "
        >
          <i
            class="fa fa-times"
            onclick="cancelAdd()"
            style="font-size: 24px; cursor: pointer"
          ></i>
          <h2 id="add-title-text" style="font-size: 18px; margin: 0">
            Новое объявление
          </h2>
          <div style="width: 24px"></div>
        </header>
        <div class="form-scroll">
          <div
            id="tariff-block"
            style="display: flex; gap: 12px; margin-bottom: 20px"
          >
            <div
              class="tariff-card-box active-std"
              id="tariff-std"
              onclick="selectTariff('standard')"
            >
              <b>Стандарт</b><br /><small>Бесплатно</small>
            </div>
            <div
              class="tariff-card-box"
              id="tariff-vip"
              onclick="selectTariff('vip')"
            >
              <b>VIP</b><br /><small>100 сом</small>
            </div>
          </div>

          <div id="vip-block" class="hidden">
            <div
              style="
                border: 2px dashed var(--yellow-main);
                border-radius: 15px;
                padding: 20px;
                margin-bottom: 20px;
                text-align: center;
              "
            >
              <p id="vip-promo-text" style="font-size: 14px; margin: 0">
                VIP-объявление будет в ТОПе 3 дня.
              </p>
              <img
                src="https://i.ibb.co/v487YmS6/photo-2025-02-18-19-14-11.jpg"
                style="
                  width: 180px;
                  height: 180px;
                  margin: 15px 0;
                  border-radius: 10px;
                  object-fit: contain;
                  background: white;
                  padding: 5px;
                "
              />
              <div
                id="receipt-label"
                style="
                  background: var(--yellow-main);
                  color: #000;
                  padding: 14px;
                  border-radius: 12px;
                  font-weight: bold;
                  cursor: pointer;
                "
                onclick="document.getElementById('receipt-input').click()"
              >
                Добавить чек
              </div>
              <input
                type="file"
                id="receipt-input"
                hidden
                onchange="handleReceiptSelect(this)"
              />
            </div>
          </div>

          <div class="f-group" id="file-group">
            <label>Фотографии (макс. 5 фото)</label>
            <div
              class="main-input"
              onclick="document.getElementById('file-input').click()"
              style="
                text-align: center;
                border: 1px dashed #555;
                cursor: pointer;
              "
            >
              <i class="fa fa-camera"></i> Выбрать фото<input
                type="file"
                id="file-input"
                multiple
                hidden
                onchange="handleFileSelect(this)"
              />
            </div>
            <div
              id="gallery-preview"
              style="
                display: flex;
                gap: 8px;
                margin-top: 10px;
                overflow-x: auto;
              "
            ></div>
          </div>

          <div class="f-group" id="cat-group">
            <label>Категория</label
            ><select id="in-cat" class="main-input">
              <option value="flowers">Цветы</option>
              <option value="jewelry">Ювелирка</option>
              <option value="gifts">Подарки</option>
              <option value="certs">Сертификаты</option>
            </select>
          </div>
          <div class="f-group" id="city-group">
            <label>Город</label
            ><select id="in-city" class="main-input">
              <option value="Бишкек">Бишкек</option>
              <option value="Ош">Ош</option>
              <option value="Манас">Манас</option>
              <option value="Токмок">Токмок</option>
              <option value="Каракол">Каракол</option>
            </select>
          </div>
          <div class="f-group">
            <label>Название товара</label
            ><input
              type="text"
              id="in-title"
              class="main-input"
              placeholder="Букет роз"
            />
          </div>
          <div class="f-group">
            <label>Цена (KGS)</label
            ><input type="number" id="in-price" class="main-input" />
          </div>
          <div class="f-group" id="date-group">
            <label>Дата получения товара</label
            ><input type="date" id="in-receive-date" class="main-input" />
          </div>
          <div class="f-group">
            <label>Адрес / Местоположение</label
            ><input
              type="text"
              id="in-address"
              class="main-input"
              placeholder="Улица, дом или район"
            />
          </div>
          <div class="f-group" id="tg-group">
            <label>Telegram (@nick)</label
            ><input
              type="text"
              id="in-tg"
              class="main-input"
              placeholder="@nickname"
            />
          </div>
          <div class="f-group" id="phone-group">
            <label>Телефон / WhatsApp</label
            ><input
              type="tel"
              id="in-wa"
              class="main-input"
              placeholder="0XXXXXXXXX"
            />
          </div>
          <div class="f-group" id="desc-group">
            <label>Описание</label
            ><textarea id="in-desc" class="main-input" rows="4"></textarea>
          </div>
          <button class="btn-premium-unity" onclick="publishAndSend()">
            Опубликовать
          </button>
        </div>
      </section>

      <!-- ИЗБРАННОЕ -->
      <section id="page-favs" class="page hidden">
        <header
          style="
            padding: 20px 15px;
            border-bottom: 1px solid #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
          "
        >
          <h2 style="margin: 0">Избранное</h2>
          <span
            onclick="clearFavs()"
            style="
              color: var(--yellow-main);
              font-weight: bold;
              cursor: pointer;
            "
            >Очистить</span
          >
        </header>
        <main id="favs-content-area"></main>
      </section>

      <!-- ПРОФИЛЬ -->
      <section id="page-profile" class="page hidden">
        <header style="padding: 15px">
          <button
            onclick="showPage('home')"
            style="
              color: var(--yellow-main);
              background: none;
              border: none;
              font-size: 18px;
              font-weight: bold;
              cursor: pointer;
            "
          >
            <i class="fa fa-arrow-left"></i> Назад
          </button>
        </header>
        <div style="text-align: center; padding: 10px 20px 20px">
          <div
            id="u-avatar-big"
            style="
              width: 70px;
              height: 70px;
              background: var(--yellow-main);
              border-radius: 50%;
              margin: 0 auto;
              display: flex;
              align-items: center;
              justify-content: center;
              color: #000;
              font-size: 24px;
              font-weight: bold;
            "
          >
            ?
          </div>
          <h2 id="u-name" style="margin-top: 10px">Никнейм</h2>
        </div>
        <div class="profile-tabs">
          <div
            class="p-tab active"
            id="tab-active"
            onclick="switchProfileTab('active')"
          >
            Активные
          </div>
          <div
            class="p-tab"
            id="tab-archive"
            onclick="switchProfileTab('archive')"
          >
            Архив
          </div>
        </div>
        <main class="listings-grid" id="my-ads-grid"></main>
      </section>

      <div
        id="product-modal"
        class="hidden"
        style="
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: var(--bg);
          z-index: 4000;
          overflow-y: auto;
        "
      >
        <div id="pv-content"></div>
      </div>

      <nav class="bottom-nav">
        <button class="nav-item active" onclick="showPage('home')" id="n-home">
          <i class="fa-solid fa-house"></i><span>Главное</span>
        </button>
        <div class="nav-center-container">
          <div class="nav-center-content" onclick="showPage('add')">
            <button class="yellow-plus-main">
              <i class="fa-solid fa-plus"></i></button
            ><span
              style="
                font-size: 12px;
                margin-top: 4px;
                color: var(--gray);
                font-weight: bold;
              "
              >Подать</span
            >
          </div>
        </div>
        <button class="nav-item" onclick="showPage('favs')" id="n-favs">
          <i class="fa-solid fa-heart"></i><span>Избранные</span>
        </button>
      </nav>
    </div>
    <script src="app.js"></script>
  </body>
</html>
